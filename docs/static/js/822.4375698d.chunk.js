"use strict";(self.webpackChunkamol_deole_portfolio=self.webpackChunkamol_deole_portfolio||[]).push([[822],{7822:(e,t,s)=>{s.r(t),s.d(t,{default:()=>k});var a=s(2555),r=s(5043),i=s(5487),l=s(3546),n=s(3771),d=s(6210),o=s(2574),c=s(5469),g=s(1286),u=s(9333),x=s(614),m=s(9292),h=s(2494),p=s(5010),v=s(7922),y=s(5746),f=s(8564),b=s(9328),j=s(6907),N=s(1045),w=s(579);const k=()=>{var e;const[t,s]=(0,r.useState)(!1),[k,C]=(0,r.useState)(!1),[_,A]=(0,r.useState)([]),[T,S]=(0,r.useState)(null),[I,E]=(0,r.useState)([]),[z,D]=(0,r.useState)(""),[M,B]=(0,r.useState)(""),[P,R]=(0,r.useState)(!1),[U,F]=(0,r.useState)(null),[L,H]=(0,r.useState)(!1),[O,G]=(0,r.useState)(!1),V=(0,r.useRef)(null),W=(0,r.useRef)(),K=b.y.getUser(),Y=(0,N.Zp)(),{isConnected:Z,on:q,off:J,sendMessage:Q,sendTyping:X,joinChat:$,leaveChat:ee}=(0,j.Y)();(0,r.useEffect)((()=>{C(b.y.isAuthenticated())}),[]),(0,r.useEffect)((()=>{k&&te()}),[k]),(0,r.useEffect)((()=>(T&&(se(T._id),$(T._id)),()=>{T&&ee(T._id)})),[T,$,ee]),(0,r.useEffect)((()=>{var e;null===(e=V.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[I]),(0,r.useEffect)((()=>(T&&L&&(W.current&&clearTimeout(W.current),W.current=setTimeout((()=>{H(!1),X(T._id,!1)}),1e3)),()=>{W.current&&clearTimeout(W.current)})),[L,T,X]),(0,r.useEffect)((()=>{const e=e=>{T&&e.chatId===T._id&&e.userId!==(null===K||void 0===K?void 0:K._id)&&G(e.isTyping)},t=e=>{console.log("New message received:",e),E((t=>t.find((t=>t._id===e._id))?(console.log("Message already exists, skipping duplicate"),t):T&&e.chatId===T._id?[...t,e]:t)),A((t=>t.map((t=>t._id===e.chatId?(0,a.A)((0,a.A)({},t),{},{unreadCount:(t.unreadCount||0)+1,lastMessage:e}):t)))),T&&e.chatId===T._id||window.dispatchEvent(new CustomEvent("toast",{detail:{type:"notification",message:"New message from ".concat(e.sender.firstName,": ").concat(e.content)}}))},s=e=>{console.log("Message delivered:",e),E((t=>t.map((t=>t.tempId===e.tempId?(0,a.A)((0,a.A)({},t),{},{_id:e.messageId,deliveredTo:[...t.deliveredTo||[],null===K||void 0===K?void 0:K._id],tempId:void 0}):t))))},r=e=>{console.error("Message error:",e),E((t=>t.filter((t=>t.tempId!==e.tempId)))),window.dispatchEvent(new CustomEvent("toast",{detail:{type:"error",message:"Failed to send message: ".concat(e.error)}}))},i=e=>{console.log("Messages read:",e),T&&e.chatId===T._id&&E((t=>t.map((t=>e.messageIds.includes(t._id)?(0,a.A)((0,a.A)({},t),{},{readBy:[...t.readBy||[],e.readBy]}):t))))};return q("userTyping",e),q("newMessage",t),q("messageDelivered",s),q("messageError",r),q("messagesRead",i),()=>{J("userTyping",e),J("newMessage",t),J("messageDelivered",s),J("messageError",r),J("messagesRead",i)}}),[T,K,q,J]);const te=async()=>{try{var e,t;R(!0);const s=await f.O.getUserChats(),a=(null===(e=s.data)||void 0===e?void 0:e.chats)||(null===(t=s.data)||void 0===t?void 0:t.items)||[];A(a)}catch(s){console.error("Failed to load chats:",s)}finally{R(!1)}},se=async e=>{try{var t,s;R(!0);const a=await f.O.getChatMessages(e),r=(null===(t=a.data)||void 0===t?void 0:t.messages)||(null===(s=a.data)||void 0===s?void 0:s.items)||[];E(r)}catch(a){console.error("Failed to load messages:",a)}finally{R(!1)}},ae=async()=>{if(z.trim()&&T)try{const e="temp_".concat(Date.now(),"_").concat(Math.random()),t={_id:e,tempId:e,chatId:T._id,sender:(0,a.A)((0,a.A)({},K),{},{lastSeen:null!==K&&void 0!==K&&K.lastSeen?new Date(K.lastSeen):void 0}),content:z.trim(),messageType:"text",createdAt:new Date,updatedAt:new Date,replyTo:U?{_id:U._id,content:U.content||"",sender:(0,a.A)((0,a.A)({},U.sender),{},{lastSeen:U.sender.lastSeen?new Date(U.sender.lastSeen):void 0})}:void 0,deliveredTo:[],readBy:[],isDeleted:!1};E((e=>[...e,t])),Q({chatId:T._id,content:z.trim(),replyTo:null===U||void 0===U?void 0:U._id,tempId:e}),D(""),F(null),H(!1),X(T._id,!1)}catch(e){console.error("Failed to send message:",e)}},re=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),ie=e=>{if("group"===e.type)return e.groupName||"Group Chat";const t=e.participants.find((e=>e._id!==(null===K||void 0===K?void 0:K._id)));return t?"".concat(t.firstName," ").concat(t.lastName):"Unknown"},le=e=>{var t;if("group"===e.type)return(null===(t=e.groupName)||void 0===t?void 0:t.charAt(0).toUpperCase())||"G";const s=e.participants.find((e=>e._id!==(null===K||void 0===K?void 0:K._id)));return s?"".concat(s.firstName.charAt(0)).concat(s.lastName.charAt(0)).toUpperCase():"U"},ne=e=>{if("group"===e.type)return!1;const t=e.participants.find((e=>e._id!==(null===K||void 0===K?void 0:K._id)));return(null===t||void 0===t?void 0:t.isOnline)||!1},de=e=>e.sender._id!==(null===K||void 0===K?void 0:K._id)?null:e.readBy&&e.readBy.length>0?(0,w.jsx)(n.A,{className:"w-3 h-3 text-blue-400"}):e.deliveredTo&&e.deliveredTo.length>0?(0,w.jsx)(n.A,{className:"w-3 h-3 text-gray-400"}):(0,w.jsx)(d.A,{className:"w-3 h-3 text-gray-400"}),oe=_.filter((e=>ie(e).toLowerCase().includes(M.toLowerCase())));return k?(0,w.jsxs)("div",{className:"fixed bottom-4 right-4 z-50",children:[(0,w.jsx)(l.N,{children:!t&&(0,w.jsxs)(i.P.button,{initial:{scale:0},animate:{scale:1},exit:{scale:0},whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>{k?s(!0):Y("/signup")},className:"p-4 rounded-full shadow-lg relative ".concat(Z?"bg-green-500 hover:bg-green-600":"bg-gray-500 hover:bg-gray-600"," text-white"),children:[(0,w.jsx)(o.A,{size:24}),(0,w.jsx)("div",{className:"absolute top-0 right-0 w-3 h-3 rounded-full border-2 border-white ".concat(Z?"bg-green-400":"bg-red-400")}),_.reduce(((e,t)=>e+(t.unreadCount||0)),0)>0&&(0,w.jsx)("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center",children:_.reduce(((e,t)=>e+(t.unreadCount||0)),0)>99?"99+":_.reduce(((e,t)=>e+(t.unreadCount||0)),0)})]})}),(0,w.jsx)(l.N,{children:t&&(0,w.jsxs)(i.P.div,{initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:20},className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl w-96 h-[600px] flex flex-col overflow-hidden border border-gray-200 dark:border-gray-700",children:[(0,w.jsxs)("div",{className:"bg-green-600 dark:bg-green-700 text-white p-4 flex items-center justify-between",children:[(0,w.jsxs)("div",{className:"flex items-center space-x-3",children:[T&&(0,w.jsx)("button",{onClick:()=>S(null),className:"p-1 hover:bg-green-700 dark:hover:bg-green-600 rounded",children:(0,w.jsx)(c.A,{size:20})}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"font-semibold",children:T?ie(T):"WhatsApp"}),T&&(0,w.jsx)("p",{className:"text-xs text-green-100",children:ne(T)?"online":null!==(e=T.participants.find((e=>e._id!==(null===K||void 0===K?void 0:K._id))))&&void 0!==e&&e.lastSeen?"last seen ".concat((e=>{const t=new Date,s=new Date(e),a=Math.floor((t.getTime()-s.getTime())/6e4);return a<1?"just now":a<60?"".concat(a,"m ago"):a<1440?"".concat(Math.floor(a/60),"h ago"):s.toLocaleDateString()})(T.participants.find((e=>e._id!==(null===K||void 0===K?void 0:K._id))).lastSeen)):"offline"})]})]}),(0,w.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,w.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(Z?"bg-green-300":"bg-red-300"),title:Z?"Connected":"Disconnected"}),T&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("button",{onClick:()=>{},className:"p-2 hover:bg-green-700 dark:hover:bg-green-600 rounded",title:"Audio Call",children:(0,w.jsx)(g.A,{size:18})}),(0,w.jsx)("button",{onClick:()=>{},className:"p-2 hover:bg-green-700 dark:hover:bg-green-600 rounded",title:"Video Call",children:(0,w.jsx)(u.A,{size:18})})]}),(0,w.jsx)("button",{onClick:()=>s(!1),className:"p-2 hover:bg-green-700 dark:hover:bg-green-600 rounded",title:"Close",children:(0,w.jsx)(x.A,{size:18})})]})]}),(0,w.jsx)("div",{className:"flex-1 overflow-hidden",children:T?(0,w.jsxs)("div",{className:"h-full flex flex-col",children:[(0,w.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 chat-messages",style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23e5ddd5' fill-opacity='0.4'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\")",backgroundColor:"#e5ddd5"},"data-messages-container":!0,children:[I.map((e=>{const t=e.sender._id===(null===K||void 0===K?void 0:K._id);return(0,w.jsx)(i.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex ".concat(t?"justify-end":"justify-start"," group"),children:(0,w.jsxs)("div",{className:"max-w-xs px-3 py-2 rounded-lg shadow-sm relative ".concat(t?"bg-green-500 text-white":"bg-white text-gray-900"," ").concat(e.tempId?"opacity-70":""),style:{borderRadius:t?"7.5px 7.5px 7.5px 0px":"7.5px 7.5px 0px 7.5px"},children:[e.replyTo&&(0,w.jsxs)("div",{className:"mb-2 p-2 rounded border-l-4 text-xs ".concat(t?"bg-green-600 border-green-300":"bg-gray-100 border-gray-400"),children:[(0,w.jsx)("p",{className:"font-medium opacity-80",children:e.replyTo.sender.firstName}),(0,w.jsx)("p",{className:"truncate opacity-70",children:e.replyTo.content})]}),e.content&&(0,w.jsx)("p",{className:"text-sm leading-relaxed",children:e.content}),e.media&&e.media.length>0&&(0,w.jsx)("div",{className:"mt-2 space-y-2",children:e.media.map((e=>(0,w.jsx)("div",{children:e.mimetype.startsWith("image/")?(0,w.jsx)("img",{src:e.url,alt:e.originalName,className:"max-w-full h-auto rounded"}):(0,w.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-2 text-xs underline",children:[(0,w.jsx)(h.A,{size:12}),(0,w.jsx)("span",{children:e.originalName})]})},e._id)))}),(0,w.jsxs)("div",{className:"flex items-center justify-end mt-1 space-x-1",children:[(0,w.jsx)("span",{className:"text-xs ".concat(t?"text-green-100":"text-gray-500"),children:re(e.createdAt)}),t&&(0,w.jsx)("div",{className:"text-green-100",children:de(e)})]}),!t&&(0,w.jsx)("button",{onClick:()=>F(e),className:"absolute right-2 top-2 opacity-0 group-hover:opacity-100 p-1 bg-gray-200 hover:bg-gray-300 rounded transition-opacity",children:(0,w.jsx)(p.A,{size:12})})]})},(e=>e.tempId||e._id)(e))})),O&&(0,w.jsx)("div",{className:"flex justify-start",children:(0,w.jsx)("div",{className:"bg-white rounded-lg px-4 py-2 shadow-sm",children:(0,w.jsxs)("div",{className:"flex space-x-1",children:[(0,w.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,w.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,w.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})}),(0,w.jsx)("div",{ref:V})]}),U&&(0,w.jsx)("div",{className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 border-l-4 border-green-500",children:(0,w.jsxs)("div",{className:"flex items-center justify-between",children:[(0,w.jsxs)("div",{children:[(0,w.jsxs)("p",{className:"text-xs font-medium text-green-600 dark:text-green-400",children:["Replying to ",U.sender.firstName]}),(0,w.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300 truncate",children:U.content})]}),(0,w.jsx)("button",{onClick:()=>F(null),className:"text-gray-400 hover:text-gray-600",children:(0,w.jsx)(x.A,{size:16})})]})}),(0,w.jsx)("div",{className:"p-3 bg-gray-50 dark:bg-gray-900",children:(0,w.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,w.jsx)("button",{className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:(0,w.jsx)(h.A,{size:20})}),(0,w.jsx)("div",{className:"flex-1 relative",children:(0,w.jsx)("input",{type:"text",value:z,onChange:e=>{D(e.target.value),!L&&e.target.value.trim()?(H(!0),T&&X(T._id,!0)):L&&!e.target.value.trim()&&(H(!1),T&&X(T._id,!1))},onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),ae())},placeholder:Z?"Type a message":"Connecting...",disabled:!Z,className:"w-full px-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 dark:text-white disabled:opacity-50 disabled:cursor-not-allowed"})}),(0,w.jsx)("button",{className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:(0,w.jsx)(v.A,{size:20})}),(0,w.jsx)("button",{onClick:ae,disabled:!z.trim()||!Z,className:"p-2 bg-green-500 text-white rounded-full hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,w.jsx)(y.A,{size:18})})]})})]}):(0,w.jsxs)("div",{className:"h-full flex flex-col",children:[(0,w.jsx)("div",{className:"p-3 bg-gray-50 dark:bg-gray-900",children:(0,w.jsxs)("div",{className:"relative",children:[(0,w.jsx)(m.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),(0,w.jsx)("input",{type:"text",placeholder:"Search or start new chat",value:M,onChange:e=>B(e.target.value),className:"w-full pl-9 pr-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 dark:text-white"})]})}),(0,w.jsx)("div",{className:"flex-1 overflow-y-auto",children:P?(0,w.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,w.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):0===oe.length?(0,w.jsx)("div",{className:"flex items-center justify-center h-full text-gray-500 dark:text-gray-400",children:(0,w.jsxs)("div",{className:"text-center",children:[(0,w.jsx)(o.A,{size:48,className:"mx-auto mb-4 opacity-50"}),(0,w.jsx)("p",{children:"No conversations yet"}),(0,w.jsx)("p",{className:"text-sm",children:"Tap the new chat button to start messaging"})]})}):oe.map((e=>{var t;return(0,w.jsx)(i.P.div,{whileHover:{backgroundColor:"rgba(0, 0, 0, 0.05)"},onClick:()=>S(e),className:"p-3 border-b border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700",children:(0,w.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,w.jsxs)("div",{className:"relative",children:[(0,w.jsx)("div",{className:"w-12 h-12 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center text-gray-700 dark:text-gray-300 font-semibold",children:le(e)}),ne(e)&&(0,w.jsx)("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white dark:border-gray-800"})]}),(0,w.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,w.jsxs)("div",{className:"flex items-center justify-between",children:[(0,w.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:ie(e)}),e.lastMessage&&(0,w.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:re(e.lastMessage.createdAt)})]}),(0,w.jsxs)("div",{className:"flex items-center justify-between",children:[(0,w.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:(null===(t=e.lastMessage)||void 0===t?void 0:t.content)||"Tap to start messaging"}),e.unreadCount>0&&(0,w.jsx)("div",{className:"bg-green-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center ml-2",children:e.unreadCount>99?"99+":e.unreadCount})]})]})]})},e._id)}))})]})})]})})]}):(0,w.jsx)("div",{className:"fixed bottom-4 right-4 z-50",children:(0,w.jsx)(i.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>Y("/signup"),className:"bg-green-500 hover:bg-green-600 text-white p-4 rounded-full shadow-lg",children:(0,w.jsx)(o.A,{size:24})})})}}}]);
//# sourceMappingURL=822.4375698d.chunk.js.map